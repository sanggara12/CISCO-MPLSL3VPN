hostname PE2
!
ip vrf A
 rd 5100:1
 route-target export 1:1
 route-target import 1:1
!
ip vrf B
 rd 5100:2
 route-target export 2:2
 route-target import 2:2
!
interface Loopback0
 ip address 200.200.200.200 255.255.255.255
!
interface GigabitEthernet0/0
 ip address 20.20.20.2 255.255.255.252
 mpls ip
!
interface GigabitEthernet0/1
 ip vrf forwarding A
 ip address 22.22.22.1 255.255.255.252
!
interface GigabitEthernet0/2
 ip vrf forwarding B
 ip address 32.32.32.1 255.255.255.252
!
router ospf 100 vrf A
 router-id 120.120.120.120
 redistribute bgp 5100 subnets route-map BGP_TO_OSPF_A
 network 22.22.22.0 0.0.0.3 area 0
!
router ospf 200 vrf B
 router-id 220.220.220.220
 redistribute bgp 5100 subnets route-map BGP_TO_OSPF_B
 network 32.32.32.0 0.0.0.3 area 0
!
router ospf 10
 router-id 200.200.200.200
 network 20.20.20.0 0.0.0.3 area 0
 network 200.200.200.200 0.0.0.0 area 0
!
router bgp 5100
 bgp router-id 200.200.200.200
 neighbor 100.100.100.100 remote-as 5100
 neighbor 100.100.100.100 update-source Loopback0
 !
 address-family vpnv4
  neighbor 100.100.100.100 activate
  neighbor 100.100.100.100 send-community extended
 exit-address-family
 !
 address-family ipv4 vrf A
  redistribute ospf 100 match internal external 1 external 2
 exit-address-family
 !
 address-family ipv4 vrf B
  redistribute ospf 200 match internal external 1 external 2
 exit-address-family
!
ip prefix-list ALL seq 5 permit 0.0.0.0/0 le 32
!
route-map BGP_TO_OSPF_A permit 10
 match ip address prefix-list ALL
!
route-map BGP_TO_OSPF_B permit 10
 match ip address prefix-list ALL
!
mpls ldp router-id Loopback0
end
